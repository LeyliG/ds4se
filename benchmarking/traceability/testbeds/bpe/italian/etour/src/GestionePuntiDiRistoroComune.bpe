▁ ï»¿ p ackage ▁unisa . gps . etour . control . Gestione PuntiDiRistoro ; ▁import ▁java . rmi . RemoteException ; ▁import ▁java . rmi . server . Uni castRemoteObject ; ▁import ▁java . sql . SQLException ; ▁import ▁java . util . ArrayList ; ▁import ▁java . util . Date ; ▁import ▁java . util . Iterator ; ▁import ▁unisa . gps . etour . bean . Bean PuntoDiRistoro ; ▁import ▁unisa . gps . etour . bean . BeanTag ; ▁import ▁unisa . gps . etour . bean . BeanVisitaPR ; ▁/ ▁* ▁* ▁For ▁import ▁junit ▁tests ▁* ▁U nisa . gps . etour . control . Gestione PuntiDiRistoro . test . stub . DBPuntoDiRistoro ; ▁* ▁Import ▁unisa . gps . etour . control . Gestione PuntiDiRistoro . test . stub . DBVisitaPR ; ▁* ▁/ ▁import ▁unisa . gps . etour . repository . DBPuntoDiRistoro ; ▁import ▁unisa . gps . etour . repository . DBVisitaPR ; ▁import ▁unisa . gps . etour . repository . DBTag ; ▁import ▁unisa . gps . etour . repository . I DBPuntoDiRistoro ; ▁import ▁unisa . gps . etour . repository . IDBTag ; ▁import ▁unisa . gps . etour . repository . IDBTurista ; ▁import ▁unisa . gps . etour . repository . IDBVisitaPR ; ▁import ▁unisa . gps . etour . util . CostantiGlobali ; ▁import ▁unisa . gps . etour . util . MessaggiErrore ; ▁/ ▁** ▁* ▁Class ▁that ▁implements ▁the ▁common ▁tasks ▁for ▁the ▁operator ▁of ▁di ning ▁and ▁* ▁For ▁the ▁Operator ▁Agency ▁* ▁* ▁@ ▁Auth or ▁J os eph ▁Mo relli ▁* ▁@ ▁Version ▁0.1 ▁ Â© ▁ 2007 ▁eTour ▁Project ▁- ▁Copy right ▁by ▁DMI ▁SE ▁@ ▁ SA ▁Lab ▁-- ▁* ▁University ▁of ▁Salerno ▁* ▁/ ▁Gestione PuntiDiRistoro Comune ▁Uni castRemoteObject ▁public ▁class ▁ext ends ▁implements ▁IGestione PuntiDiRistoro Comune ▁( ▁/ ▁/ ▁ Instance ▁for ▁database ▁connections ▁private ▁static ▁final ▁long ▁s erial Version UID ▁= ▁1 L ; ▁prot ected ▁I DBPuntoDiRistoro ▁puntoRistoro ; ▁prot ected ▁IDBTag ▁tags ; ▁IDBVisitaPR ▁prot ected ▁feed s ; ▁prot ected ▁IDBTurista ▁dbTurista ; ▁public ▁Gestione PuntiDiRistoro Comune ▁() ▁throws ▁RemoteException ▁( ▁super ▁(); ▁/ ▁/ ▁Connect ▁to ▁the ▁Database ▁TR Y ▁( ▁puntoRistoro ▁= ▁new ▁ DBPuntoDiRistoro ▁(); ▁tag ▁= ▁new ▁ DBTag ▁(); ▁feed ▁= ▁new ▁ DBVisitaPR ▁(); ▁) ▁/ ▁/ ▁Note : ▁no ▁long er ▁' cause ▁SQLException ▁thrown ▁/ ▁/ ▁Change s ▁to ▁the ▁layer ▁DB ; ▁changed ▁Exception ▁catch ▁( Exception ▁e ) ▁( ▁System . out . println ▁( ▁" Error :" ▁+ ▁e . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁) ▁/ ▁* ▁* ▁Method ▁which ▁allow s ▁to ▁obtain ▁a ▁Bean PuntoDiRistoro ▁through ▁* ▁Connect ▁to ▁database ▁* ▁/ ▁public ▁Bean PuntoDiRistoro ▁ottieni PuntoDiRistoro ▁( int ▁p PuntoDiRistoroID ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁identifier ▁passed ▁if ▁( p PuntoDiRistoroID ▁<0) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁/ ▁Return ▁ Instance ▁Bean PuntoDiRistoro ▁toReturn ▁= ▁null ; ▁TR Y ▁( ▁/ ▁/ ▁Re venue ▁data ▁through ▁the ▁instance ▁of ▁the ▁database ▁connection ▁toReturn ▁= ▁puntoRistoro . ottieni PuntoDiRistoro ▁( p PuntoDiRistoroID ); ▁) ▁/ ▁/ ▁Exception ▁in ▁database ▁operations ▁catch ▁( SQLException ▁e ) ▁( ▁System . out . println ▁( ▁" Error :" ▁+ ▁e . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exceptions ▁due ▁to ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out . println ▁( ▁" Error :" ▁+ ▁ee . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁/ ▁/ ▁Check ▁the ▁variable ▁return , ▁so ▁the y ▁do ▁not ▁pass ▁b ad ▁data ▁/ ▁/ ▁To ▁the ▁caller ▁/ ▁/ ▁And ▁trigger s ▁an ▁exception ▁if ▁the ▁format ▁of ▁the ▁bean ▁if ▁( null ▁== ▁toReturn ) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ FORMAT O _ BEAN ); ▁/ ▁/ ▁Return ▁the ▁bean ▁that ▁contains ▁information ▁about ▁Refreshment ▁/ ▁/ ▁Require d ▁toReturn ▁return ; ▁) ▁/ ▁/ ▁Method ▁that ▁returns ▁an ▁ArrayList ▁containing ▁the ▁tag ▁identificat ion ▁of ▁a ▁/ ▁/ ▁S ome ▁Refreshment ▁< BeanTag > ▁ottieniTag PuntoDiRistoro ▁public ▁ArrayList ▁( int ▁p PuntoDiRistoroID ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁identifier ▁passed ▁if ▁( p PuntoDiRistoroID ▁<0) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁/ ▁Return ▁ Instance ▁ArrayList ▁< BeanTag > ▁toReturn ▁= ▁null ; ▁TR Y ▁( ▁/ ▁/ ▁Re venue ▁data ▁through ▁the ▁instance ▁of ▁the ▁database ▁connection ▁toReturn ▁= ▁tag . ottieniTag PuntoDiRistoro ▁( p PuntoDiRistoroID ); ▁) ▁/ ▁/ ▁Exception ▁in ▁operations ▁on ▁database ▁catch ▁( SQLException ▁e ) ▁( ▁System . out . println ▁( ▁" Error :" ▁+ ▁e . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exceptions ▁due ▁to ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out . println ▁( ▁" Error :" ▁+ ▁ee . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁/ ▁/ ▁Check ▁the ▁variable ▁return , ▁so ▁the y ▁do ▁not ▁pass ▁b ad ▁data ▁/ ▁/ ▁To ▁the ▁caller ▁/ ▁/ ▁And ▁trigger s ▁an ▁exception ▁if ▁the ▁format ▁of ▁the ▁bean ▁if ▁( null ▁== ▁toReturn ) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ FORMAT O _ BEAN ); ▁/ ▁/ ▁Return ▁the ▁ArrayList ▁containing ▁beans ▁tag ▁of ▁refreshment ▁/ ▁/ ▁Pass ed ▁as ▁parameter ▁toReturn ▁return ; ▁) ▁/ ▁/ ▁Return s ▁an ▁array ▁of ▁10 ▁strings ▁containing ▁the ▁last ▁10 ▁comments ▁/ ▁/ ▁I ssued ▁by ▁tourists ▁for ▁Refreshment ▁passed ▁as ▁parameter ▁public ▁String ▁[] ▁ottieni UltimiCommenti ▁( int ▁p PuntoDiRistoroID ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁the ▁validit y ▁identifier ▁passed ▁if ▁( p PuntoDiRistoroID ▁<0) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁/ ▁String ▁that ▁contains ▁on ly ▁the ▁last ▁10 ▁comments ▁made ▁String ▁[] ▁toReturn ▁= ▁new ▁String ▁[10] ; ▁/ ▁/ ▁ArrayList ▁temporar y ▁then ▁save ▁the ▁comments ▁contain ed ▁in ▁the ▁beans ▁/ ▁/ ▁ Inside ▁< BeanVisitaPR > ▁ArrayList ▁temp ▁= ▁null ; ▁TR Y ▁( ▁/ ▁/ ▁A ttempt ▁to ▁retrieve ▁information ▁from ▁the ▁database ▁via ▁/ ▁/ ▁The ▁connection ▁instance ▁temp ▁= ▁feed . ottieni ListaVisitaPR ▁( p PuntoDiRistoroID ); ▁) ▁/ ▁/ ▁Exception ▁in ▁database ▁operations ▁catch ▁( SQLException ▁e ) ▁( ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ottieni UltimiCommenti " ▁+ ▁E . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exceptions ▁due ▁to ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ottieni UltimiCommenti " ▁E e . toString ▁+ ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁/ ▁/ ▁The ▁bean ▁that ▁I ▁receive ▁from ▁the ▁database ▁are ▁al read y ▁sort ed ▁by ▁date ▁/ ▁/ ▁I mplic it ly , ▁so ▁there ▁is ▁no ▁need ▁for ▁sort ing ▁algorithm s ▁for ▁( int ▁i ▁= ▁0; ▁i ▁ <10; ▁i ▁+ ▁+) ▁( ▁/ ▁/ ▁Insert ▁the ▁text ▁of ▁the ▁comments ▁in ▁cycl ical ly ▁/ ▁/ ▁Array ▁toReturn ▁[ i ] ▁= ▁( temp . get ▁( temp . size ▁() ▁- ▁( i ▁+ ▁1) )). ▁get Commento ▁(); ▁) ▁/ ▁/ ▁E ▁' un necessary ▁control ▁the ▁format ▁of ▁the ▁array ▁/ ▁/ ▁The n ▁return ▁the ▁array ▁ direct ly ▁with ▁comments ▁toReturn ▁return ; ▁) ▁/ ▁/ ▁Method ▁that ▁returns ▁an ▁ArrayList ▁containing ▁the ▁number ▁of ▁votes ▁/ ▁/ ▁Release ▁from ▁1 ▁to ▁5 ▁for ▁/ ▁/ ▁The ▁Refreshment ▁passed ▁as ▁parameter . ▁The ▁method ▁insert s ▁in ▁order ▁/ ▁/ ▁ Count er s ▁in ▁position s ▁/ ▁/ ▁ From ▁0 ▁to ▁1 ▁vote , ▁1 ▁vote ▁for ▁2, ▁etc . ▁ . . ▁public ▁ArrayList ▁< Integer > ▁ottieni Statistiche PuntoDiRistoro ▁( ▁p PuntoDiRistoroID ▁int ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁the ▁validit y ▁identifier ▁passed ▁if ▁( p PuntoDiRistoroID ▁<0) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁/ ▁ArrayList ▁that ▁allow s ▁me ▁to ▁store ▁the ▁bean ▁containing ▁the ▁feedback ▁ArrayList ▁< BeanVisitaPR > ▁bVisita ▁= ▁null ; ▁/ ▁/ ▁ArrayList ▁that ▁allow s ▁me ▁to ▁store ▁the ▁counters ▁/ ▁/ ▁And ▁then ▁return ▁to ▁the ▁call ing ▁method ▁ArrayList ▁< Integer > ▁listaRisultati ▁< Integer > ▁= ▁new ▁ArrayList ▁( 5); ▁/ ▁/ ▁Initializ e ▁the ▁array ▁of ▁counters ▁for ▁( int ▁i ▁= ▁0; ▁i ▁ <5; ▁i ▁+ ▁+) ▁listaRisultati . add ▁( Integer . valueOf ▁(0) ); ▁/ ▁/ ▁Data ▁use ful ▁to ▁verify ▁that ▁the ▁issued ▁date ▁back ▁thi rty ▁Feedback ▁/ ▁/ ▁Day s ▁from ▁current ▁date ▁Date ▁ul timiTrentaGiorni ▁= ▁new ▁Date ▁( new ▁Date ▁() . ▁Get Time ▁() ▁- ▁CostantiGlobali . TR ENTA _ GIORNI ); ▁System . out . println ▁( ▁" The ▁date ▁of ▁30 ▁days ▁a go :" ▁+ ▁ul timiTrentaGiorni ); ▁TR Y ▁( ▁/ ▁/ ▁All ▁feedback ▁Re venue ▁issued ▁for ▁Refreshment ▁/ ▁/ ▁Pass ed ▁as ▁parameter ▁bVisita ▁= ▁feed . ottieni ListaVisitaPR ▁( p PuntoDiRistoroID ); ▁/ ▁/ ▁Iter ate ▁the ▁collection ▁of ▁elements ▁to ▁control ▁the ▁bean ▁/ ▁/ ▁Visit s ▁for ▁( Iterator ▁< BeanVisitaPR > ▁i teratoreVisitaPR ▁= ▁bVisita . iterator ▁(); ▁i teratoreVisitaPR ▁ . ▁ hasNext ▁(); ) ▁( ▁/ ▁/ ▁Recuper to ▁the ▁BeanVisitaPR ▁BeanVisitaPR ▁bVisitaTemp ▁= ▁i teratoreVisitaPR . next ▁(); ▁/ ▁/ ▁... ▁Do ▁not ▁know ▁wh at ▁do es ▁... ▁System . out . println ▁( ▁" The ▁date ▁of ▁this ▁visit ▁is : ▁B Visita Temp . get DataVisita ▁+ ▁()); ▁if ▁( bVisitaTemp . get DataVisita ▁() . ▁after ▁( ul timiTrentaGiorni )) ▁listaRisultati . set ▁( bVisitaTemp . get Voto ▁() ▁- ▁1, ▁Integer ▁ . ▁ valueOf ▁( listaRisultati . get ▁( ▁bVisitaTemp . get Voto ▁() ▁- ▁1) . ▁intValue ▁() ▁+ ▁1) ); ▁) ▁) ▁/ ▁/ ▁Exception ▁in ▁database ▁operations ▁catch ▁( SQLException ▁e ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ottieni Statistiche PuntoDiRistoro " ▁+ ▁E . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exceptions ▁due ▁to ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ottieni Statistiche PuntoDiRistoro " ▁E e . toString ▁+ ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁if ▁( null ▁== ▁listaRisultati ) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ FORMAT O _ BEAN ); ▁/ ▁/ ▁Return ▁the ▁list ▁of ▁results ▁that ▁should ▁contain ▁counters ▁/ ▁/ ▁Comment s ▁/ ▁/ ▁I ssued ▁in ▁the ▁last ▁30 ▁days ▁listaRisultati ▁return ; ▁) ▁/ ▁/ ▁Method ▁that ▁allow s ▁you ▁to ▁change ▁the ▁comment ▁issued ▁for ▁a ▁/ ▁/ ▁Refreshment ▁public ▁boolean ▁ modificaFeedback PuntoDiRistoro ▁( int ▁p PuntoDiRistoroId , ▁BeanVisitaPR ▁nuovaVisita ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁the ▁validit y ▁of ▁past ▁data ▁if ▁( ( p PuntoDiRistoroId ▁<0) ▁| ▁| ▁(! ▁( nuovaVisita ▁instance of ▁BeanVisitaPR ))) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁/ ▁Re venue ▁from ▁the ▁database ▁the ▁bean ▁and ▁store s ▁saved ▁/ ▁/ ▁In ▁order ▁to ▁verify ▁that ▁the ▁vote ▁has ▁not ▁changed ▁/ ▁/ ▁W hich ▁ha d ▁be en ▁previously ▁released ▁BeanVisitaPR ▁temp ▁= ▁null ; ▁TR Y ▁( ▁temp ▁= ▁feed . ottieni VisitaPR ▁( p PuntoDiRistoroId , ▁nuovaVisita ▁ . ▁get IdTurista ▁()); ▁) ▁/ ▁/ ▁Exception ▁running ▁the ▁operation ▁on ▁Database ▁catch ▁( SQLException ▁e ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ modificaFeedback PuntoDiRistoro " ▁+ ▁E . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exception ▁ca used ▁by ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ modificaFeedback PuntoDiRistoro " ▁E e . toString ▁+ ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁/ ▁/ ▁I f ▁the ▁vote ▁was ▁amended ▁returns ▁an ▁exception ▁if ▁( temp . get Voto ▁()! ▁nuovaVisita . get Voto ▁= ▁()) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ FORMAT O _ BEAN ); ▁/ ▁/ ▁I f ▁the ▁vote ▁has ▁not ▁be en ▁amended ▁sh all ▁save ▁the ▁new ▁/ ▁/ ▁Comment ▁in ▁the ▁database ▁us ing ▁the ▁specific ▁method ▁of ▁the ▁bean ▁else ▁( ▁TR Y ▁( ▁feed . modifica VisitaPR ▁( nuovaVisita ); ▁return ▁true ; ▁) ▁/ ▁/ ▁Exception ▁running ▁the ▁operation ▁on ▁Database ▁catch ▁( SQLException ▁e ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ modificaFeedback PuntoDiRistoro " ▁+ ▁E . toString ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁/ ▁/ ▁U nexpected ▁exception ▁ca used ▁by ▁other ▁fa ctors ▁catch ▁( Exception ▁ee ) ▁( ▁System . out ▁ . ▁System . out . println ▁( ▁" Error ▁in ▁method ▁ modificaFeedback PuntoDiRistoro " ▁E e . toString ▁+ ▁()); ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁) ▁) ▁)