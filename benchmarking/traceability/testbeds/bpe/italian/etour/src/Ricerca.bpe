▁ ï»¿ p ackage ▁unisa . gps . etour . control . GestioneRicerche ; ▁import ▁java . rmi . RemoteException ; ▁import ▁java . rmi . server . Uni castRemoteObject ; ▁import ▁java . sql . SQLException ; ▁import ▁java . util . ArrayList ; ▁import ▁java . util . Hashtable ; ▁import ▁unisa . gps . etour . bean . Bean BeneCulturale ; ▁import ▁unisa . gps . etour . bean . Bean PuntoDiRistoro ; ▁import ▁unisa . gps . etour . bean . BeanTag ; ▁import ▁unisa . gps . etour . repository . DBBeneCulturale ; ▁import ▁unisa . gps . etour . repository . DBPuntoDiRistoro ; ▁import ▁unisa . gps . etour . repository . DBTag ; ▁import ▁unisa . gps . etour . repository . IDBBeneCulturale ; ▁import ▁unisa . gps . etour . repository . I DBPuntoDiRistoro ; ▁import ▁unisa . gps . etour . repository . IDBTag ; ▁import ▁unisa . gps . etour . util . ControlloDati ; ▁import ▁unisa . gps . etour . util . MessaggiErrore ; ▁import ▁unisa . gps . etour . util . Punto 3 D ; ▁public ▁class ▁Search ▁ext ends ▁Uni castRemoteObject ▁implements ▁ IRicerca ▁( ▁private ▁static ▁final ▁long ▁s erial Version UID ▁= - 600 9809 0973 02 884 655 L ; ▁public ▁Search ▁() ▁throws ▁RemoteException ▁( ▁super ▁(); ▁) ▁/ ▁/ ▁Search ▁Parameter s ▁private ▁int ▁pIdTurista ▁= ▁ -1; ▁private ▁String ▁pParoleChiave ; ▁private ▁double ▁pRaggioMax ; ▁P rivate ▁Punto 3 D ▁ pPosizioneUtente ; ▁private ▁int ▁pE lementiPerPagina ▁= ▁ -1; ▁private ▁byte ▁pTipologiaSito ▁= ▁ -1; ▁/ ▁/ ▁Object s ▁for ▁the ▁database ▁connection ▁P rivate ▁ IDBBeneCulturale ▁ BeneCulturale ▁= ▁new ▁ DBBeneCulturale ▁(); ▁P rivate ▁I DBPuntoDiRistoro ▁ PuntoDiRistoro ▁= ▁new ▁ DBPuntoDiRistoro ▁(); ▁P rivate ▁IDBTag ▁Tag ▁ DBTag ▁= ▁new ▁(); ▁/ ▁/ ▁List ▁of ▁tags ▁obtained ▁private ▁ArrayList ▁< BeanTag > ▁pTags ; ▁/ ▁/ ▁Search ▁Results ▁pages ▁for ▁parti tion ed ▁private ▁ Hashtable ▁< Integer , ▁ArrayList ▁< Bean BeneCulturale > > ▁ risultatiRicerca BeniCulturali ▁= ▁new ▁ Hashtable ▁< Integer , ▁ArrayList ▁< Bean BeneCulturale > > ▁(); ▁private ▁ Hashtable ▁< Integer , ▁ArrayList ▁< Bean PuntoDiRistoro > > ▁ risultatiRicerca PuntiDiRistoro ▁= ▁new ▁ Hashtable ▁< Integer , ▁ArrayList ▁< Bean PuntoDiRistoro > > ▁(); ▁/ ▁/ ▁Qua nt ity ▁of ▁items ▁and ▁pages ▁results ▁in ▁the ▁research ▁phase ▁private ▁int ▁numero PagineRisultati ▁= ▁ -1; ▁private ▁int ▁numero ElementiRicerca ▁= ▁ -1; ▁/ ▁* ▁( Non - Java doc ) ▁U nisa . gps . etour . control . GestioneRicerche . IRicerca ▁* ▁@ ▁ see ▁# ▁search ▁( int , ▁java . lang . String , ▁int ▁[] , ▁double , ▁int , ▁unisa . gps . etour . util . Punto 3 D , ▁byte ) ▁* ▁/ ▁public ▁int ▁search ▁( int ▁pIdTurista , ▁pParoleChiave ▁String , ▁int ▁[] ▁pTagsId , ▁pRaggioMax ▁double , ▁int ▁pE lementiPerPagina , ▁Punto 3 D ▁ pPosizioneUtente , ▁byte ▁pTipologiaSito ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁ Reset ▁the ▁parameters ▁of ▁the ▁previous ▁search ▁azzera Parametri ▁(); ▁/ ▁/ ▁ Sta r t ▁check ing ▁the ▁correct ness ▁of ▁the ▁search ▁parameters ▁TR Y ▁( ▁this . pIdTurista ▁= ▁pIdTurista ; ▁this . pTags ▁= ▁array To ArrayList Tag ▁( pTagsId ); ▁this . pParoleChiave ▁= ▁ControlloDati . corr e ggi Stringa ▁( pParoleChiave , ▁true , ▁true , ▁"", ▁ControlloDati . LU NG HE ZZA _ MA SSIMA ); ▁this . pRaggioMax ▁= ▁pRaggioMax ; ▁this . pPosizioneUtente ▁= ▁ pPosizioneUtente ; ▁this . pTipologiaSito ▁= ▁pTipologiaSito ; ▁/ ▁/ ▁I f ▁the ▁parameters ▁are ▁valid , ▁I ▁get ▁the ▁number ▁of ▁results ▁if ▁( pE lementiPerPagina > ▁0 ▁& ▁& ▁( ( P Tip ologia Sito ▁== ▁0) ▁| ▁| ▁( pTipologiaSito ▁== ▁1) ) ▁PR aggio Ma x ▁& ▁& > ▁0 ▁PPosizione Utente ▁& ▁& ! ▁= ▁Null ▁& ▁& ▁( This . numero ElementiRicerca ▁= ▁ottieniNumero ElementiRicerca Specializzat o ▁()) > ▁= ▁0) ▁( ▁this . pE lementiPerPagina ▁= ▁pE lementiPerPagina ; ▁this . numero PagineRisultati ▁= ▁calcolaNumero PagineRicerca ▁(); ▁this . numero ElementiRicerca ▁return ; ▁) ▁/ ▁/ ▁Otherwise ▁returns ▁-1 ▁else ▁return ▁ -1; ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁) ▁/ ▁* ▁( Non - Java doc ) ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . GestioneRicerche . IRicerca ▁# ▁ottieni PaginaRisultati BeneCulturale ▁( int ) ▁* ▁/ ▁public ▁Bean BeneCulturale ▁[] ▁ottieni PaginaRisultati BeneCulturale ▁( int ▁pPagina ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁that ▁the ▁type ▁of ▁site ▁is ▁valid ▁and ▁that ▁the ▁page ▁is ▁/ ▁/ ▁In ▁the ▁range ▁if ▁( ( this . pTipologiaSito ▁== ▁ BENE _ CULTURALE ) ▁& ▁& ▁controlla Pagina ▁( pPagina )) ▁( ▁/ ▁/ ▁T ransform ▁the ▁list ▁obtained ▁in ▁array ▁Bean BeneCulturale ▁[] ▁results ▁= ▁new ▁Bean BeneCulturale ▁[ calcola NumeroElementi Pagina ▁( pPagina ) ]; ▁/ ▁/ ▁Results ▁= ▁ricerca BeniCulturali PerPagina ▁( pPagina ) . ▁ ToArray ▁( ▁/ ▁/ ▁Results ); ▁results ▁= ▁ricerca PerPagina ▁( pPagina ) . ▁to Array ▁( result s ); ▁return ▁results ; ▁) ▁else ▁return ▁null ; ▁) ▁/ ▁* ▁( Non - Java doc ) ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . GestioneRicerche . IRicerca ▁# ▁ottieni PaginaRisultati PuntoDiRistoro ▁( int ) ▁* ▁/ ▁public ▁Bean PuntoDiRistoro ▁[] ▁ottieni PaginaRisultati PuntoDiRistoro ▁( int ▁pPagina ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Check ▁that ▁the ▁type ▁of ▁site ▁is ▁valid ▁and ▁that ▁the ▁page ▁is ▁/ ▁/ ▁In ▁the ▁range ▁if ▁( ( this . pTipologiaSito ▁== ▁ PUNTO _ DI _ RISTORO ) ▁& ▁& ▁Controlla Pagina ▁( pPagina )) ▁( ▁/ ▁/ ▁T ransform ▁the ▁list ▁obtained ▁in ▁array ▁Bean PuntoDiRistoro ▁[] ▁results ▁= ▁new ▁Bean PuntoDiRistoro ▁[ calcola NumeroElementi Pagina ▁( pPagina ) ]; ▁/ ▁/ ▁Results ▁= ▁ricerca PuntiDiRistoro PerPagina ▁( pPagina ) . ▁ ToArray ▁( ▁/ ▁/ ▁Results ); ▁results ▁= ▁ricerca PerPagina ▁( pPagina ) . ▁to Array ▁( result s ); ▁return ▁results ; ▁) ▁else ▁return ▁null ; ▁) ▁/ ▁* ▁( Non - Java doc ) ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . GestioneRicerche . IRicerca ▁# ▁ottieniNumero ElementiRicerca ▁() ▁* ▁/ ▁public ▁int ▁ottieniNumero ElementiRicerca ▁() ▁throws ▁RemoteException ▁( ▁numero ElementiRicerca ▁return ; ▁) ▁/ ▁* ▁( Non - Java doc ) ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . GestioneRicerche . IRicerca ▁# ▁ottieniNumero PagineRicerca ▁() ▁* ▁/ ▁public ▁int ▁ottieniNumero PagineRicerca ▁() ▁throws ▁RemoteException ▁( ▁numero PagineRisultati ▁return ; ▁) ▁/ ▁** ▁* ▁Method ▁for ▁returning ▁the ▁number ▁of ▁finding s ▁from ▁research ▁* ▁* ▁@ ▁Return ▁number ▁of ▁finding s ▁from ▁research . ▁On ▁error ▁* ▁Return s ▁-1 ▁* ▁@ ▁Throw s ▁SQLException ▁Exception ▁Connect ing ▁to ▁Database ▁* ▁/ ▁private ▁int ▁ottieniNumero ElementiRicerca Specializzat o ▁() ▁throws ▁SQLException ▁( ▁/ ▁/ ▁Check ▁the ▁type ▁of ▁site ▁and ▁get s ▁the ▁number ▁of ▁results ▁if ▁( controllaId Turista ▁()) ▁( ▁switch ▁( pTipologiaSito ) ▁( ▁homes ▁ BENE _ CULTURALE : ▁return ▁pIdTurista > ▁0 ? ▁ BeneCulturale ▁ . ▁ottieni NumeroElementi RicercaAvanzata ▁( ▁this . pIdTurista , ▁this . pParoleChiave , ▁this . pTags , ▁this . pPosizioneUtente , ▁this . pRaggioMax ) : ▁ BeneCulturale ▁ . ▁ottieniNumero ElementiRicerca ▁( this . pParoleChiave , ▁this . pTags , ▁this . pPosizioneUtente , ▁this . pRaggioMax ); ▁homes ▁ PUNTO _ DI _ RISTORO : ▁return ▁pIdTurista > ▁0 ? ▁ PuntoDiRistoro ▁ . ▁ottieni NumeroElementi RicercaAvanzata ▁( ▁this . pIdTurista , ▁this . pParoleChiave , ▁this . pTags , ▁this . pPosizioneUtente , ▁this . pRaggioMax ) : ▁ PuntoDiRistoro ▁ . ▁ottieniNumero ElementiRicerca ▁( this . pParoleChiave , ▁this . pTags , ▁this . pPosizioneUtente , ▁this . pRaggioMax ); ▁) ▁) ▁return ▁ -1; ▁) ▁/ ▁** ▁* ▁Method ▁for ▁returning ▁the ▁list ▁of ▁results ▁* ▁* ▁@ ▁Param ▁pNumeroPagina ▁range ▁of ▁results ▁to ▁return ▁* ▁@ ▁Return ▁ Contain er ▁site s ▁e merged ▁in ▁the ▁research ▁phase ▁as ▁the ▁interval ▁* ▁@ ▁Throw s ▁RemoteException ▁Exception ▁Remote ▁* ▁/ ▁private ▁ArrayList ▁< ? > ▁ricerca PerPagina ▁( int ▁pNumeroPagina ) ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁De c lare ▁the ▁list ▁of ▁site s ▁relat ed ▁to ▁the ▁page ▁input ▁ArrayList ▁< ? > ▁Risultati PaginaCorrente ▁= ▁null ; ▁TR Y ▁( ▁if ▁( controllaId Turista ▁()) ▁( ▁/ ▁/ ▁Check ▁the ▁type ▁of ▁site ▁switch ▁( pTipologiaSito ) ▁( ▁homes ▁ BENE _ CULTURALE : ▁/ ▁/ ▁I f ▁the ▁list ▁has ▁not ▁al read y ▁be en ▁obtained ▁previously ▁/ ▁/ ▁Search ▁if ▁( ( risulta tiPaginaCorrente ▁= ▁ risultatiRicerca BeniCulturali ▁ . ▁get ▁( pNumeroPagina )) ▁== ▁null ) ▁( ▁risultati PaginaCorrente ▁= ▁( ArrayList ▁< ? > ) ▁( pIdTurista > ▁0 ? ▁ BeneCulturale ▁ . ▁ricerca Avanzata ▁( pIdTurista , ▁pParoleChiave , ▁pTags , ▁pNumeroPagina , ▁pE lementiPerPagina , ▁ pPosizioneUtente , ▁pRaggioMax ) ▁ : ▁ BeneCulturale . ricerca ▁( pParoleChiave , ▁pTags , ▁pNumeroPagina , ▁pE lementiPerPagina , ▁ pPosizioneUtente , ▁pRaggioMax )); ▁ risultatiRicerca BeniCulturali ▁ . ▁put ▁( ▁pNumeroPagina , ▁( ArrayList ▁< Bean BeneCulturale > ) ▁risultati PaginaCorrente ); ▁) ▁brea k ; ▁homes ▁ PUNTO _ DI _ RISTORO : ▁/ ▁/ ▁I f ▁the ▁list ▁has ▁not ▁al read y ▁be en ▁obtained ▁previously ▁/ ▁/ ▁Search ▁if ▁( ( risulta tiPaginaCorrente ▁= ▁ risultatiRicerca PuntiDiRistoro ▁ . ▁get ▁( pNumeroPagina )) ▁== ▁null ) ▁( ▁risultati PaginaCorrente ▁= ▁( ArrayList ▁< ? > ) ▁( pIdTurista > ▁0 ? ▁ PuntoDiRistoro ▁ . ▁ricerca Avanzata ▁( pIdTurista , ▁pParoleChiave , ▁pTags , ▁pNumeroPagina , ▁pE lementiPerPagina , ▁ pPosizioneUtente , ▁pRaggioMax ) ▁ : ▁ PuntoDiRistoro . ricerca ▁( pParoleChiave , ▁pTags , ▁pNumeroPagina , ▁pE lementiPerPagina , ▁ pPosizioneUtente , ▁pRaggioMax )); ▁ risultatiRicerca PuntiDiRistoro ▁ . ▁put ▁( ▁pNumeroPagina , ▁( ArrayList ▁< Bean PuntoDiRistoro > ) ▁risultati PaginaCorrente ); ▁) ▁brea k ; ▁) ▁) ▁/ ▁/ ▁Return ▁the ▁results ▁risultati PaginaCorrente ▁return ; ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁) ▁/ ▁** ▁* ▁Method ▁for ▁calculat ing ▁the ▁number ▁of ▁pages ▁found ▁at ▁* ▁Search ▁* ▁* ▁@ ▁Return ▁man y ▁pages ▁in ▁the ▁research ▁phase ▁* ▁/ ▁private ▁int ▁calcolaNumero PagineRicerca ▁() ▁( ▁/ ▁/ ▁I f ▁the ▁number ▁of ▁pages ▁is ▁great er ▁th an ▁or ▁equal ▁to ▁0 ▁returns ▁the ▁number ▁of ▁/ ▁/ ▁P age s ▁if ▁( numero PagineRisultati > ▁= ▁0) ▁numero PagineRisultati ▁return ; ▁/ ▁/ ▁I f ▁the ▁number ▁of ▁elements ▁is ▁a ▁mu ltipl e ▁of ▁the ▁number ▁of ▁items ▁per ▁page ▁/ ▁/ ▁Return ▁the ir ▁relationship ▁if ▁( ( numero ElementiRicerca % ▁pE lementiPerPagina ▁== ▁0)) ▁return ▁( numero ElementiRicerca ▁/ ▁pE lementiPerPagina ); ▁/ ▁/ ▁Otherwise ▁returns ▁the ir ▁relationship ▁+ ▁1 ▁return ▁( numero ElementiRicerca ▁/ ▁pE lementiPerPagina ) ▁+ ▁1; ▁) ▁/ ▁** ▁* ▁Method ▁for ▁calculat ing ▁the ▁number ▁of ▁elements ▁of ▁nell ' int e vallo ▁* ▁A ▁given ▁page ▁* ▁* ▁@ ▁Param ▁interval ▁nPagina ▁results ▁* ▁@ ▁Return ▁number ▁of ▁elements ▁in ▁a ▁page ▁* ▁/ ▁private ▁int ▁calcola NumeroElementi Pagina ▁( int ▁nPagina ) ▁( ▁/ ▁/ ▁I f ▁page ▁number ▁is ▁the ▁last ▁return ▁the ir ▁form ▁if ▁( n Pagina ▁== ▁( numero PagineRisultati ▁- ▁1) ) ▁return ▁( numero ElementiRicerca % ▁pE lementiPerPagina ); ▁/ ▁/ ▁Otherwise ▁returns ▁the ▁number ▁of ▁items ▁per ▁page ▁else ▁return ▁( pE lementiPerPagina ); ▁) ▁/ ▁** ▁* ▁Method ▁for ▁check ing ▁the ▁validit y ▁of ▁a ▁page ▁* ▁* ▁@ ▁Param ▁pPagina ▁page ▁to ▁check ▁* ▁@ ▁Return ▁true ▁if ▁the ▁page ▁is ▁valid ▁* ▁/ ▁private ▁boolean ▁controlla Pagina ▁( int ▁pPagina ) ▁( ▁/ ▁/ ▁I f ▁page ▁number ▁is ▁in ▁the ▁range ▁returns ▁true ▁return ▁( pPagina > ▁= ▁0 ▁& ▁& ▁pPagina ▁< numero PagineRisultati ); ▁) ▁/ ▁** ▁* ▁Method ▁for ▁check ing ▁the ▁correct ness ▁of ▁the ▁identifier ▁Tourist ▁* ▁* ▁@ ▁Return ▁true ▁if ▁the ▁identifier ▁is ▁valid , ▁false ▁otherwise ▁* ▁/ ▁private ▁boolean ▁controlla IdTurista ▁() ▁( ▁return ▁( ( pIdTurista > ▁0) ▁| ▁| ▁( pIdTurista ▁== ▁-1) ); ▁) ▁/ ▁** ▁* ▁Method ▁to ▁reset ▁all ▁the ▁variables ▁relat ed ▁to ▁a ▁search ▁* ▁* ▁@ ▁Return ▁A ▁con s ta nt ▁that ▁indicate s ▁the ▁correct ▁zero ▁* ▁/ ▁private ▁int ▁azzera Parametri ▁() ▁( ▁/ ▁/ ▁Clear s ▁all ▁the ▁search ▁parameters ▁pIdTurista ▁= ▁ -1; ▁pTipologiaSito ▁= ▁ -1; ▁pE lementiPerPagina ▁= ▁ -1; ▁numero ElementiRicerca ▁= ▁ -1; ▁numero PagineRisultati ▁= ▁ -1; ▁ risultatiRicerca BeniCulturali . clear ▁(); ▁ risultatiRicerca PuntiDiRistoro . clear ▁(); ▁return ▁ -1; ▁) ▁/ ▁** ▁* ▁Method ▁for ▁the ▁detect ion ▁and ▁conversion ▁of ▁data ▁tags ▁in ▁strutt ara ▁List ▁* ▁* ▁@ ▁Param ▁list ▁of ▁identifier s ▁pTagsId ▁Search ▁Tags ▁* ▁@ ▁Return ▁List ▁Search ▁Tags ▁* ▁@ ▁Throw s ▁SQLException ▁* ▁/ ▁private ▁ArrayList ▁< BeanTag > ▁array To ArrayList Tag ▁( int ▁[] ▁pTagsId ) ▁throws ▁SQLException ▁( ▁/ ▁/ ▁Initializ e ▁the ▁list ▁of ▁Tags ▁< BeanTag > ▁PTags ▁ArrayList ▁< BeanTag > ▁= ▁new ▁ArrayList ▁(); ▁/ ▁/ ▁I f ▁the ▁list ▁of ▁identifier s ▁of ▁the ▁tag ▁is ▁empty ▁I ▁get ▁the ▁tags ▁if ▁( pTagsId ▁= ▁null ) ▁( ▁BeanTag ▁ currentTag ▁= ▁null ; ▁TR Y ▁( ▁/ ▁/ ▁ Loop ▁for ▁the ▁insertion ▁of ▁tags ▁found ▁in ▁the ▁list ▁for ▁( int ▁i ▁= ▁0; ▁i ▁< pTagsId . length ▁i ▁+ ▁+) ▁( ▁/ ▁/ ▁I f ▁the ▁identifier ▁is ▁great er ▁th an ▁0 ▁if ▁( pTagsId ▁[ i ] > ▁0) ▁( ▁ currentTag ▁= ▁Tag . ottieniTag ▁( pTagsId ▁[ i ]); ▁/ ▁/ ▁Check ▁correct ness ▁on ▁tags ▁if ▁( ControlloDati . check BeanTag ▁( currentTag )) ▁pTags . add ▁( currentTag ); ▁) ▁) ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁SQLException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁) ▁/ ▁/ ▁Return ▁the ▁list ▁of ▁tags ▁pTags ▁return ; ▁) ▁)